# Direnv –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è venv

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **direnv** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ direnv –∫ –æ–±–æ–ª–æ—á–∫–µ

–î–æ–±–∞–≤—å—Ç–µ **–æ–¥–∏–Ω —Ä–∞–∑** –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

```bash
eval "$(direnv hook bash)"
```

> ‚ö†Ô∏è –ë–µ–∑ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ direnv –Ω–µ —Å–º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª–Ω—è—Ç—å `.envrc`.

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ü–æ—Å–ª–µ `make init` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.envrc`:

```bash
export PG_HA_PATRONI_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
export ANSIBLE_CONFIG=$PG_HA_PATRONI_HOME/ansible.cfg
source $PG_HA_PATRONI_HOME/ansible-venv/bin/activate
```

2. –†–∞–∑—Ä–µ—à–∏—Ç–µ direnv –∏—Å–ø–æ–ª–Ω—è—Ç—å `.envrc`:

```bash
direnv allow
```

---

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `ansible-venv`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  - `$PG_HA_PATRONI_HOME` ‚Äî –ø—É—Ç—å –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞
  - `$ANSIBLE_CONFIG` ‚Äî –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Ansible

> üí° –ü–æ—Å–ª–µ –∫–ª–æ–Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ `.envrc` –±—É–¥–µ—Ç **–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω**, –∏ direnv –≤—ã–¥–∞—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:  
> `direnv: error /path/to/pg-ha-patroni/.envrc is blocked. Run 'direnv allow' to approve its content.`

---

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã venv –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
echo $PG_HA_PATRONI_HOME
which ansible
```

- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å direnv:

```bash
direnv deny
```

- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `.envrc` –ø–æ—Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ `direnv allow`.
