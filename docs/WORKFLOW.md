# Workflow проекта pg-ha-patroni (визуальный, расширенный)

## Полный цикл работы проекта с опциональными шагами

```bash
┌──────────────┐
│ Git clone    │
│ pg-ha-patroni│
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ scripts/fix_executable_rights.sh │
│ (проверка и фиксация прав .sh)   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ make setup   │
│ (установка системных пакетов,    │
│ setup_system.sh)                 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ make init    │
│ (создание venv, установка ansible, │
│ генерация .envrc)                 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ direnv allow │
│ (активация venv и переменных) │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ make up      │
│ (поднять кластер Vagrant) │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ make ansible │
│ (проверка доступности нод) │
└──────┬───────┘
       │
       ▼
┌───────────────┐
│ Кластер       │
│ работает      │
└──────┬────────┘
       │
 ┌─────┴────────┐
 │              │
 ▼              ▼
make halt     make destroy
│              │
│ После halt можно выключить компьютер
│ и потом продолжить работу с кластером
│ используя make up / vagrant up
└──────────────┘
```

### Пояснения

- `make halt` — остановка VM, сохраняется состояние кластера на диски  
- `make destroy` — удаление всего кластера и информации о нем с дисков  
- Диаграмма показывает полный цикл: установка → проверка прав → инициализация → поднятие → проверка → управление кластером  
- Опциональные шаги (`scripts/fix_executable_rights.sh`, `make setup`) помогают настроить окружение на новой машине
