# Workflow проекта pg-ha-patroni (визуальный, расширенный)

## Полный цикл работы проекта с опциональными шагами

┌──────────────┐
│ Git clone │
│ pg-ha-patroni│
└──────┬───────┘
│
▼
✨ Опционально:
┌──────────────┐
│ scripts/fix_executable_rights.sh │
│ (проверка и фиксация прав .sh) │
└──────┬───────┘
│
▼
✨ Опционально:
┌──────────────┐
│ make setup │
│ (установка системных пакетов, │
│ setup_system.sh) │
└──────┬───────┘
│
▼
┌──────────────┐
│ make init │
│ (создание venv, установка ansible, │
│ генерация .envrc) │
└──────┬───────┘
│
▼
┌──────────────┐
│ direnv allow │
│ (активация venv и переменных) │
└──────┬───────┘
│
▼
┌──────────────┐
│ make up │
│ (поднять кластер Vagrant) │
└──────┬───────┘
│
▼
┌──────────────┐
│ make ansible │
│ (проверка доступности нод) │
└──────┬───────┘
│
▼
┌───────────────┐
│ Кластер │
│ работает │
└──────┬────────┘
│
┌─────┴────────┐
│ │
▼ ▼
make halt make destroy
│ │
│ После halt можно выключить компьютер
│ и потом продолжить работу с кластером
│ используя make up / vagrant up
└──────────────┘


### Пояснения к расширенной версии

- ✨ **Опциональные шаги**: `scripts/fix_executable_rights.sh` и `make setup` / `setup_system.sh`.  
- `make init` — создаёт Python-venv, устанавливает Ansible, генерирует `.envrc`.  
- `direnv allow` — один раз разрешаем выполнение `.envrc` для автоматической активации окружения.  
- `make up` — поднимает все VM по Vagrantfile.  
- `make ansible` — проверка доступности всех нод через Ansible.  
- `make halt` — останавливает кластер, сохраняя данные на дисках.  
- `make destroy` — полностью удаляет кластер и все данные.